<section class="mt-8">
  <h1 class="mb-8 text-3xl font-bold" title="Historial de transacciones" aria-label="Historial de transacciones">
    Historial de transacciones
  </h1>

  <!-- tools -->
  <div>
    <app-record-filters (filtersChange)="applyFilters($event)"></app-record-filters>
  </div>

  <div class="mt-8">
    <!-- card -->
    @for (transaction of transactions(); track transaction.id) {
    <div class="p-6 mb-4 rounded-lg bg-primary-50 cursor-pointer md:flex md:items-center md:justify-between md:gap-6" (click)="openEditRecordDialog(transaction)">
      <div class="flex flex-1 items-center gap-6">
        <app-transaction-icon class="hidden md:block" [typeRecord]="transaction.typeRecord" [size]="'48px'"></app-transaction-icon>

        <div class="flex flex-col w-full gap-4 md:flex-col-reverse">
          <!-- tags -->
          <div class="flex items-center gap-4 mb-2 text-sm font-bold">
            <div class="flex justify-center items-center gap-2 px-4 py-2 bg-primary-300 rounded-full">
              <span>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
                  <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
                    <path d="M2 7a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2z" />
                    <circle cx="12" cy="12" r="3" />
                    <path d="M2 9a4 4 0 0 0 4-4v0m12 14a4 4 0 0 1 4-4v0" />
                  </g>
                </svg>
              </span>
              <span>{{ transaction.account.name }}</span>
            </div>

            @if (transaction.category) {
            <div class="flex justify-center items-center gap-2 px-4 py-2 bg-violet-300 rounded-full">
              <span>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
                  <path fill="currentColor"
                    d="M7.425 9.475L11.15 3.4q.15-.25.375-.363T12 2.925t.475.113t.375.362l3.725 6.075q.15.25.15.525t-.125.5t-.35.363t-.525.137h-7.45q-.3 0-.525-.137T7.4 10.5t-.125-.5t.15-.525M17.5 22q-1.875 0-3.187-1.312T13 17.5t1.313-3.187T17.5 13t3.188 1.313T22 17.5t-1.312 3.188T17.5 22M3 20.5v-6q0-.425.288-.712T4 13.5h6q.425 0 .713.288T11 14.5v6q0 .425-.288.713T10 21.5H4q-.425 0-.712-.288T3 20.5m14.5-.5q1.05 0 1.775-.725T20 17.5t-.725-1.775T17.5 15t-1.775.725T15 17.5t.725 1.775T17.5 20M5 19.5h4v-4H5zM10.05 9h3.9L12 5.85zm7.45 8.5" />
                </svg>
              </span>
              <span>{{ transaction.category.name }}</span>
            </div>
            }
          </div>

          <!-- details -->
          <div class="w-full">
            <h2 class="text-xl font-bold">{{ transaction.title }}</h2>
            @if (transaction.description === '') {
              <p class="w-full text-gray-500 md:max-w-1/2 md:hidden">
                {{ transaction.date_time | date:'short' }}
              </p>
            }
            @else {
              <p class="w-full md:max-w-1/2 truncate text-gray-500">
                {{ transaction.description }}
              </p>
            }
          </div>
        </div>
      </div>

      <div class="flex flex-none items-center gap-4 mt-6 md:m-0 md:flex-col md:gap-1">
        <app-transaction-icon class="md:hidden" [typeRecord]="transaction.typeRecord"></app-transaction-icon>

        <!-- -500 si es expense o +500 si es income o 500 si es transfer -->
        <!-- en transaction.currency  -->
        <p class="text-lg font-bold"
          [class]="{'text-red-600': transaction.typeRecord == 'expense' || transaction.typeRecord == 'investment', 'text-green-600': transaction.typeRecord == 'income', 'text-primary-600': transaction.typeRecord == 'transfer'}">
          @if (transaction.typeRecord === 'income') {
          +{{ transaction.amount | number:'1.2-2' }} {{ transaction.currency }}
          }
          @if (transaction.typeRecord === 'expense') {
          -{{ transaction.amount | number:'1.2-2' }} {{ transaction.currency }}
          }
          @if (transaction.typeRecord === 'transfer') {
          {{ transaction.amount | number:'1.2-2' }} {{ transaction.currency }}
          }
          @if (transaction.typeRecord === 'investment') {
          -{{ transaction.amount | number:'1.2-2' }} {{ transaction.currency }}
          }
        </p>

        <p class="hidden text-gray-500 md:block">
          {{ transaction.date_time | date:'short' }}
        </p>
      </div>
    </div>
    }
  </div>

  <app-create-records (newRecord)="handleNewRecord($event)"></app-create-records>
  <app-edit-records [currentRecord]="recordToEdit()" (updatedRecord)="handleUpdatedRecord($event)"></app-edit-records>
</section>
